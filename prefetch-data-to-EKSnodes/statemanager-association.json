{
  "Name": "AWS-RunShellScript",
  "Targets": [
    {
      "Key": "tag:Name",
      "Values": ["$EDP_NAME-nodegroup-Node"]
    }
  ],
  "Parameters": {
    "commands": [
      "sudo su",
      "aws ecr get-login-password --region $EDP_AWS_REGION | docker login --username AWS --password-stdin $EDP_AWS_ACCOUNT.dkr.ecr.$EDP_AWS_REGION.amazonaws.com",
      "tag=$(aws ecr describe-images --repository-name $EDP_NAME --query 'sort_by(imageDetails,& imagePushedAt)[-1].imageTags[0]' --output text)",
      "echo $tag",
      "docker pull $EDP_AWS_ACCOUNT.dkr.ecr.$EDP_AWS_REGION.amazonaws.com/$EDP_NAME:$tag"
    ]
  },
  "AssociationName": "$EDP_NAME"
}
